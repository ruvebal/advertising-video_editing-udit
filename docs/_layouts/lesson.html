---
layout: default
---

{% comment %} Detect if TOC exists (supports raw {:toc} and rendered HTML) {% endcomment %}
{% assign has_toc = false %}
{% if page.content contains '{:toc}' %}
	{% assign has_toc = true %}
{% elsif page.content contains 'id="markdown-toc"' %}
	{% assign has_toc = true %}
{% endif %}

{% if has_toc %}
<button class="toc-toggle" id="toc-toggle" aria-label="Open table of contents" aria-expanded="false">
	<svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
		<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
	</svg>
	<span class="toc-toggle-text">{% if page.lang == "es" %}Contenido{% else %}Contents{% endif %}</span>
</button>
<div class="toc-backdrop" id="toc-backdrop" aria-hidden="true"></div>
{% endif %}

<div class="lesson-wrapper">
	{% if has_toc %}
	<aside class="lesson-toc" id="lesson-toc" aria-label="{% if page.lang == 'es' %}Tabla de contenidos{% else %}Table of Contents{% endif %}">
		<div class="toc-container">
			<div class="toc-header">
				<h2 class="toc-title">
					{% if page.lang == "es" %} Tabla de contenidos {% else %} Table of Contents {% endif %}
				</h2>
				<button class="toc-close" id="toc-close" aria-label="Close table of contents">
					<svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
					</svg>
				</button>
			</div>
			<nav class="toc-nav" id="toc-nav">
				<div id="toc-sidebar-placeholder" class="toc-content"></div>
			</nav>
		</div>
	</aside>
	{% endif %}

	<div class="lesson-main">
		<article class="lesson-content">
			<!-- Breadcrumb Navigation -->
			<nav class="breadcrumb" aria-label="Breadcrumb">
				<ol class="breadcrumb-list">
					<li class="breadcrumb-item">
						<a href="{{ site.baseurl }}/" class="breadcrumb-link">Home</a>
					</li>
					<li class="breadcrumb-item">
						<span class="breadcrumb-separator" aria-hidden="true">/</span>
						<a href="{{ site.baseurl }}/" class="breadcrumb-link">Lessons</a>
					</li>
					<li class="breadcrumb-item breadcrumb-current" aria-current="page">
						<span class="breadcrumb-separator" aria-hidden="true">/</span>
						<span class="breadcrumb-text">Week {{ page.week }}</span>
					</li>
				</ol>
			</nav>

			<header class="lesson-header">
				<div class="week-badge">Week {{ page.week }} of 10</div>
				{% if page.status %}
				{% assign status_lower = page.status | downcase %}
				<span class="lesson-status status-{{ page.status | downcase | replace: ' ', '-' }} flex-shrink-0">
					{% if status_lower == 'finished' or status_lower == 'terminado' %}
						{% if page.lang == 'es' %}‚úì Finalizado{% else %}‚úì Finished{% endif %}
					{% elsif status_lower == 'draft' or status_lower == 'borrador' %}
						{% if page.lang == 'es' %}Borrador{% else %}Draft{% endif %}
					{% elsif status_lower == 'in progress' or status_lower == 'in-progress' or status_lower == 'en proceso' %}
						{% if page.lang == 'es' %}En Proceso{% else %}In Progress{% endif %}
					{% else %}
						{{ page.status | capitalize }}
					{% endif %}
				</span>
				{% endif %}
				<h1 class="lesson-title">{{ page.title }}</h1>
				{% if page.description %}
				<p class="lesson-lead">{{ page.description }}</p>
				{% endif %}
			</header>

			<!-- Navigation -->
			<nav class="lesson-nav" aria-label="Lesson navigation">
				{% if page.prev_week.number %}
				<a href="{{ site.baseurl }}{{ page.prev_week.url }}" class="nav-btn prev">
					‚Üê Week {{ page.prev_week.number }}
				</a>
				{% else %}
				<span class="nav-btn disabled"></span>
				{% endif %}
				
				<a href="{{ site.baseurl }}/" class="nav-btn home">
					‚Üë All Weeks
				</a>
				
				{% if page.next_week.number %}
				<a href="{{ site.baseurl }}{{ page.next_week.url }}" class="nav-btn next">
					Week {{ page.next_week.number }} ‚Üí
				</a>
				{% else %}
				<span class="nav-btn disabled"></span>
				{% endif %}
			</nav>

			<div class="lesson-body prose prose-lg prose-slate dark:prose-invert">
				{{ content }}
			</div>

			<!-- Footer Navigation -->
			<footer class="lesson-footer">
				<nav class="lesson-nav" aria-label="Lesson navigation">
					{% if page.prev_week.number %}
					<a href="{{ site.baseurl }}{{ page.prev_week.url }}" class="nav-btn prev">
						‚Üê {{ page.prev_week.title }}
					</a>
					{% else %}
					<span class="nav-btn disabled"></span>
					{% endif %}
					
					{% if page.next_week.number %}
					<a href="{{ site.baseurl }}{{ page.next_week.url }}" class="nav-btn next">
						{{ page.next_week.title }} ‚Üí
					</a>
					{% else %}
					<span class="nav-btn disabled"></span>
					{% endif %}
				</nav>
			</footer>
		</article>
	</div>
</div>

<script>
;(function () {
	const toc = document.getElementById('markdown-toc');
	const placeholder = document.getElementById('toc-sidebar-placeholder');

	if (toc && placeholder) {
		placeholder.appendChild(toc);
	}

	const tocHeading = document.querySelector('h2.no_toc');
	if (tocHeading) {
		const text = tocHeading.textContent.toLowerCase();
		if (text.includes('table of contents') || text.includes('tabla de contenidos') || text.includes('üìã')) {
			tocHeading.style.display = 'none';
		}
	}

	const tocToggle = document.getElementById('toc-toggle');
	const tocClose = document.getElementById('toc-close');
	const lessonToc = document.getElementById('lesson-toc');
	const tocBackdrop = document.getElementById('toc-backdrop');

	function openTOC() {
		if (lessonToc) {
			lessonToc.setAttribute('aria-expanded', 'true');
			lessonToc.style.display = 'block';
			lessonToc.style.transform = 'translateX(0)';
			lessonToc.style.visibility = 'visible';
			lessonToc.style.opacity = '1';
			lessonToc.style.zIndex = '100';
		}
		if (tocToggle) tocToggle.setAttribute('aria-expanded', 'true');
		if (tocBackdrop) tocBackdrop.setAttribute('aria-hidden', 'false');
		document.body.classList.add('toc-open');
		document.body.style.overflow = 'hidden';
	}

	function closeTOC() {
		if (lessonToc) {
			lessonToc.setAttribute('aria-expanded', 'false');
			lessonToc.style.display = '';
			lessonToc.style.transform = '';
			lessonToc.style.visibility = '';
			lessonToc.style.opacity = '';
			lessonToc.style.zIndex = '';
		}
		if (tocToggle) tocToggle.setAttribute('aria-expanded', 'false');
		if (tocBackdrop) tocBackdrop.setAttribute('aria-hidden', 'true');
		document.body.classList.remove('toc-open');
		document.body.style.overflow = '';
	}

	if (tocToggle && lessonToc) {
		tocToggle.addEventListener('click', openTOC);
	}

	if (tocClose && lessonToc) {
		tocClose.addEventListener('click', closeTOC);
	}

	if (tocBackdrop) {
		tocBackdrop.addEventListener('click', closeTOC);
	}

	if (placeholder && placeholder.querySelector('a')) {
		const tocLinks = placeholder.querySelectorAll('a[href^="#"]');
		const sections = Array.from(tocLinks)
			.map((link) => {
				const id = link.getAttribute('href').substring(1);
				const element = document.getElementById(id);
				return element ? { link, element, id } : null;
			})
			.filter(Boolean);

		if (sections.length > 0) {
			const observerOptions = {
				rootMargin: '-20% 0px -70% 0px',
				threshold: 0,
			};

			let isScrollingProgrammatically = false;

			const observer = new IntersectionObserver((entries) => {
				if (isScrollingProgrammatically) return;

				entries.forEach((entry) => {
					if (entry.isIntersecting) {
						tocLinks.forEach((link) => {
							link.classList.remove('toc-active');
							link.parentElement?.classList.remove('toc-item-active');
						});

						const activeSection = sections.find((s) => s.element === entry.target);
						if (activeSection) {
							activeSection.link.classList.add('toc-active');
							activeSection.link.parentElement?.classList.add('toc-item-active');

							const tocNav = document.getElementById('toc-nav');
							if (tocNav && activeSection.link.offsetParent) {
								isScrollingProgrammatically = true;

								const linkTop = activeSection.link.offsetTop;
								const linkHeight = activeSection.link.offsetHeight;
								const navHeight = tocNav.offsetHeight;
								const navScrollTop = tocNav.scrollTop;

								if (linkTop < navScrollTop) {
									tocNav.scrollTo({ top: linkTop - 20, behavior: 'smooth' });
								} else if (linkTop + linkHeight > navScrollTop + navHeight) {
									tocNav.scrollTo({ top: linkTop - navHeight + linkHeight + 20, behavior: 'smooth' });
								}

								setTimeout(() => {
									isScrollingProgrammatically = false;
								}, 500);
							}
						}
					}
				});
			}, observerOptions);

			sections.forEach((section) => observer.observe(section.element));

			const lessonMain = document.querySelector('.lesson-main');

			tocLinks.forEach((link) => {
				link.addEventListener('click', (e) => {
					const href = link.getAttribute('href');
					if (href.startsWith('#')) {
						const target = document.querySelector(href);
						if (target && lessonMain) {
							e.preventDefault();
							const headerOffset = 100;

							const containerRect = lessonMain.getBoundingClientRect();
							const targetRect = target.getBoundingClientRect();
							const scrollTop = lessonMain.scrollTop;

							const targetTop = targetRect.top - containerRect.top + scrollTop;
							const offsetPosition = targetTop - headerOffset;

							lessonMain.scrollTo({
								top: offsetPosition,
								behavior: 'smooth',
							});

							history.pushState(null, '', href);

							if (window.innerWidth <= 1024) {
								closeTOC();
							}
						}
					}
				});
			});
		}
	}
})();
</script>

